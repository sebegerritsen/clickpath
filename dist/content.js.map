{"version":3,"file":"content.js","mappings":"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","sources":["webpack://clickpath/./src/content/tour-engine.ts","webpack://clickpath/./src/content/content-script.ts"],"sourcesContent":["/**\n * Tour Engine - Core tour rendering and navigation\n * Based on ui-patterns.json onboarding tour pattern\n */\n\nimport type { TourDefinition, TourStep, TourState, TourPage } from '../shared/types';\n\nexport class TourEngine {\n  private tour: TourDefinition;\n  private currentPageIndex: number;\n  private currentStepIndex: number = 0;\n  private overlay: HTMLElement | null = null;\n  private state: TourState;\n\n  constructor(tour: TourDefinition, startPageIndex: number = 0) {\n    this.tour = tour;\n    this.currentPageIndex = startPageIndex;\n    this.state = {\n      tourId: tour.id,\n      currentPageIndex: startPageIndex,\n      currentStepIndex: 0,\n      startedAt: Date.now(),\n      lastActivityAt: Date.now()\n    };\n  }\n\n  public start(): void {\n    console.log(`[ClickPath] Starting tour: ${this.tour.name}`);\n    this.createOverlay();\n    this.showStep();\n  }\n\n  public stop(): void {\n    console.log(`[ClickPath] Stopping tour: ${this.tour.name}`);\n    this.removeOverlay();\n  }\n\n  public getState(): TourState {\n    return { ...this.state };\n  }\n\n  private get currentPage(): TourPage {\n    return this.tour.pages[this.currentPageIndex];\n  }\n\n  private get currentStep(): TourStep {\n    return this.currentPage.steps[this.currentStepIndex];\n  }\n\n  private get totalSteps(): number {\n    return this.currentPage.steps.length;\n  }\n\n  private createOverlay(): void {\n    // Create overlay container\n    this.overlay = document.createElement('div');\n    this.overlay.className = 'clickpath-overlay';\n    this.overlay.innerHTML = `\n      <div class=\"clickpath-highlight\" id=\"clickpathHighlight\"></div>\n      <div class=\"clickpath-tooltip\" id=\"clickpathTooltip\">\n        <div class=\"clickpath-step-indicator\"></div>\n        <h4 class=\"clickpath-title\"></h4>\n        <p class=\"clickpath-content\"></p>\n        <div class=\"clickpath-buttons\">\n          <button class=\"clickpath-btn clickpath-btn-skip\">Skip Tour</button>\n          <div class=\"clickpath-nav-buttons\">\n            <button class=\"clickpath-btn clickpath-btn-back\">Back</button>\n            <button class=\"clickpath-btn clickpath-btn-next clickpath-btn-primary\">Next</button>\n          </div>\n        </div>\n      </div>\n    `;\n\n    // Add event listeners\n    this.overlay.querySelector('.clickpath-btn-skip')?.addEventListener('click', () => this.skip());\n    this.overlay.querySelector('.clickpath-btn-back')?.addEventListener('click', () => this.prevStep());\n    this.overlay.querySelector('.clickpath-btn-next')?.addEventListener('click', () => this.nextStep());\n\n    document.body.appendChild(this.overlay);\n  }\n\n  private removeOverlay(): void {\n    if (this.overlay) {\n      this.overlay.remove();\n      this.overlay = null;\n    }\n  }\n\n  private showStep(): void {\n    if (!this.overlay) return;\n\n    const step = this.currentStep;\n    const highlight = this.overlay.querySelector('#clickpathHighlight') as HTMLElement;\n    const tooltip = this.overlay.querySelector('#clickpathTooltip') as HTMLElement;\n\n    // Check step condition\n    if (step.condition?.elementExists) {\n      const exists = document.querySelector(step.condition.elementExists);\n      if (!exists) {\n        this.nextStep();\n        return;\n      }\n    }\n\n    // Find target element\n    let targetElement: Element | null = null;\n    if (step.element) {\n      targetElement = document.querySelector(step.element);\n\n      // Try fallback selectors if primary fails\n      if (!targetElement && step.elementFallback) {\n        for (const fallback of step.elementFallback) {\n          targetElement = document.querySelector(fallback);\n          if (targetElement) break;\n        }\n      }\n    }\n\n    // Update highlight position\n    if (targetElement) {\n      const rect = targetElement.getBoundingClientRect();\n      const padding = this.tour.settings.spotlightPadding ?? 8;\n\n      highlight.style.display = 'block';\n      highlight.style.top = `${rect.top + window.scrollY - padding}px`;\n      highlight.style.left = `${rect.left + window.scrollX - padding}px`;\n      highlight.style.width = `${rect.width + padding * 2}px`;\n      highlight.style.height = `${rect.height + padding * 2}px`;\n\n      // Scroll element into view\n      if (this.tour.settings.scrollBehavior !== 'none') {\n        targetElement.scrollIntoView({\n          behavior: this.tour.settings.scrollBehavior ?? 'smooth',\n          block: 'center'\n        });\n      }\n\n      // Set click-through if enabled\n      if (step.interaction?.clickThrough) {\n        highlight.style.pointerEvents = 'none';\n      } else {\n        highlight.style.pointerEvents = 'auto';\n      }\n    } else {\n      // No target element - center tooltip\n      highlight.style.display = 'none';\n    }\n\n    // Update tooltip content\n    const titleEl = tooltip.querySelector('.clickpath-title') as HTMLElement;\n    const contentEl = tooltip.querySelector('.clickpath-content') as HTMLElement;\n    const indicatorEl = tooltip.querySelector('.clickpath-step-indicator') as HTMLElement;\n\n    titleEl.textContent = step.title;\n    contentEl.innerHTML = step.content; // Allow basic HTML in content\n    indicatorEl.textContent = `Step ${this.currentStepIndex + 1} of ${this.totalSteps}`;\n\n    // Position tooltip\n    this.positionTooltip(tooltip, targetElement, step.position);\n\n    // Update button visibility\n    const backBtn = tooltip.querySelector('.clickpath-btn-back') as HTMLElement;\n    const nextBtn = tooltip.querySelector('.clickpath-btn-next') as HTMLElement;\n    const skipBtn = tooltip.querySelector('.clickpath-btn-skip') as HTMLElement;\n\n    backBtn.style.display = this.currentStepIndex > 0 ? 'block' : 'none';\n    nextBtn.textContent = this.currentStepIndex === this.totalSteps - 1 ? 'Finish' : 'Next';\n    skipBtn.style.display = this.tour.settings.allowSkip ? 'block' : 'none';\n\n    // Update state\n    this.state.currentStepIndex = this.currentStepIndex;\n    this.state.lastActivityAt = Date.now();\n  }\n\n  private positionTooltip(\n    tooltip: HTMLElement,\n    target: Element | null,\n    preferredPosition?: string\n  ): void {\n    const tooltipRect = tooltip.getBoundingClientRect();\n    const viewportWidth = window.innerWidth;\n    const viewportHeight = window.innerHeight;\n    const margin = 16;\n\n    if (!target) {\n      // Center in viewport\n      tooltip.style.top = `${(viewportHeight - tooltipRect.height) / 2}px`;\n      tooltip.style.left = `${(viewportWidth - tooltipRect.width) / 2}px`;\n      return;\n    }\n\n    const targetRect = target.getBoundingClientRect();\n    let position = preferredPosition || 'auto';\n\n    // Auto-detect best position\n    if (position === 'auto') {\n      const spaceAbove = targetRect.top;\n      const spaceBelow = viewportHeight - targetRect.bottom;\n      const spaceLeft = targetRect.left;\n      const spaceRight = viewportWidth - targetRect.right;\n\n      if (spaceBelow >= tooltipRect.height + margin) {\n        position = 'bottom';\n      } else if (spaceAbove >= tooltipRect.height + margin) {\n        position = 'top';\n      } else if (spaceRight >= tooltipRect.width + margin) {\n        position = 'right';\n      } else if (spaceLeft >= tooltipRect.width + margin) {\n        position = 'left';\n      } else {\n        position = 'bottom'; // Default fallback\n      }\n    }\n\n    let top: number;\n    let left: number;\n\n    switch (position) {\n      case 'top':\n        top = targetRect.top + window.scrollY - tooltipRect.height - margin;\n        left = targetRect.left + window.scrollX + (targetRect.width - tooltipRect.width) / 2;\n        break;\n      case 'bottom':\n        top = targetRect.bottom + window.scrollY + margin;\n        left = targetRect.left + window.scrollX + (targetRect.width - tooltipRect.width) / 2;\n        break;\n      case 'left':\n        top = targetRect.top + window.scrollY + (targetRect.height - tooltipRect.height) / 2;\n        left = targetRect.left + window.scrollX - tooltipRect.width - margin;\n        break;\n      case 'right':\n        top = targetRect.top + window.scrollY + (targetRect.height - tooltipRect.height) / 2;\n        left = targetRect.right + window.scrollX + margin;\n        break;\n      default:\n        top = targetRect.bottom + window.scrollY + margin;\n        left = targetRect.left + window.scrollX;\n    }\n\n    // Keep tooltip in viewport\n    left = Math.max(margin, Math.min(left, viewportWidth - tooltipRect.width - margin));\n    top = Math.max(margin, Math.min(top, viewportHeight - tooltipRect.height - margin + window.scrollY));\n\n    tooltip.style.top = `${top}px`;\n    tooltip.style.left = `${left}px`;\n  }\n\n  private nextStep(): void {\n    if (this.currentStepIndex < this.totalSteps - 1) {\n      this.currentStepIndex++;\n      this.showStep();\n    } else {\n      this.complete();\n    }\n  }\n\n  private prevStep(): void {\n    if (this.currentStepIndex > 0) {\n      this.currentStepIndex--;\n      this.showStep();\n    }\n  }\n\n  private skip(): void {\n    console.log(`[ClickPath] Tour skipped: ${this.tour.name}`);\n    this.saveProgress('skipped');\n    this.stop();\n  }\n\n  private complete(): void {\n    console.log(`[ClickPath] Tour completed: ${this.tour.name}`);\n    this.saveProgress('completed');\n    this.stop();\n  }\n\n  private saveProgress(status: 'completed' | 'skipped'): void {\n    const key = `tour_completed_${this.tour.id}`;\n    chrome.storage.local.set({\n      [key]: {\n        status,\n        completedAt: Date.now(),\n        version: this.tour.version\n      }\n    });\n  }\n}\n","/**\n * Corporater ClickPath Content Script\n * Injected into Corporater pages to provide guided tours\n * Fetches tours directly from Corporater API using session cookies\n */\n\nimport { TourEngine } from './tour-engine';\nimport type { TourDefinition, MessageType, MessageResponse, ThemeColors } from '../shared/types';\n\n// API response is an array with flat structure (from Corporater table output)\ninterface ClickPathApiRecord {\n  success: boolean;\n  primary: string;\n  primaryDark: string;\n  primaryLight: string;\n  background: string;\n  text: string;\n  textMuted: string;\n  successColor: string;\n  warning: string;\n  enableAutoStart: boolean;\n  enableHelpButton: boolean;\n  user: string;\n  tours: string; // JSON string containing tour definitions\n}\n\ntype ClickPathApiResponse = ClickPathApiRecord[];\n\nclass ClickPathContent {\n  private tourEngine: TourEngine | null = null;\n  private tours: TourDefinition[] = [];\n  private config = {\n    enableAutoStart: true,\n    enableHelpButton: true\n  };\n\n  constructor() {\n    this.init();\n  }\n\n  private async init() {\n    console.log('[ClickPath] Content script initialized on:', window.location.href);\n\n    // Apply any cached theme immediately\n    await this.applyCachedTheme();\n\n    // Load tours from Corporater API\n    await this.loadFromCorporater();\n\n    // Fall back to bundled tours if API fails\n    if (this.tours.length === 0) {\n      await this.loadBundledTours();\n    }\n\n    // Set up message listener for popup/background communication\n    chrome.runtime.onMessage.addListener(this.handleMessage.bind(this));\n\n    // Check for auto-start tours\n    if (this.config.enableAutoStart) {\n      this.checkAutoStart();\n    }\n\n    // Inject floating help button\n    if (this.config.enableHelpButton) {\n      this.injectHelpButton();\n    }\n  }\n\n  /**\n   * Fetch config and colors directly from Corporater API\n   * Uses browser session cookies - no credentials needed\n   */\n  private async loadFromCorporater(): Promise<void> {\n    try {\n      // Build endpoint URL (relative to current page, no trailing slash)\n      const endpoint = '/CorpoWebserver/api/clickpath/v1';\n\n      console.log('[ClickPath] Fetching from Corporater API:', endpoint);\n\n      const response = await fetch(endpoint, {\n        method: 'GET',\n        credentials: 'include', // Include session cookies\n        headers: {\n          'Accept': 'application/json'\n        }\n      });\n\n      if (!response.ok) {\n        console.warn(`[ClickPath] API returned ${response.status}`);\n        return;\n      }\n\n      const data: ClickPathApiResponse = await response.json();\n\n      // API returns array with single record\n      if (data && data.length > 0 && data[0].success) {\n        const record = data[0];\n        console.log(`[ClickPath] Loaded config from Corporater for user: ${record.user}`);\n\n        // Parse tours from JSON string\n        if (record.tours) {\n          try {\n            // Tours field is a comma-joined string of JSON objects\n            const toursArray = JSON.parse(`[${record.tours}]`);\n            this.tours = toursArray.filter((t: unknown): t is TourDefinition =>\n              typeof t === 'object' && t !== null && 'id' in t\n            );\n            console.log(`[ClickPath] Loaded ${this.tours.length} tours from API`);\n            chrome.storage.local.set({ cachedTours: this.tours });\n          } catch (e) {\n            console.warn('[ClickPath] Failed to parse tours JSON:', e);\n          }\n        }\n\n        // Apply colors (map flat structure to theme colors)\n        const colors: Partial<ThemeColors> = {\n          primary: record.primary,\n          primaryDark: record.primaryDark,\n          primaryLight: record.primaryLight,\n          background: record.background,\n          text: record.text,\n          textMuted: record.textMuted,\n          success: record.successColor, // Note: API field is 'successColor'\n          warning: record.warning\n        };\n        this.applyTheme(colors);\n        chrome.storage.local.set({ cachedColors: colors });\n\n        // Apply config\n        this.config = {\n          enableAutoStart: record.enableAutoStart,\n          enableHelpButton: record.enableHelpButton\n        };\n        chrome.storage.local.set({ cachedConfig: this.config });\n      }\n    } catch (error) {\n      console.warn('[ClickPath] Failed to load from Corporater API:', error);\n\n      // Try to use cached data\n      const cached = await chrome.storage.local.get(['cachedTours', 'cachedColors', 'cachedConfig']);\n      if (cached.cachedTours) {\n        this.tours = cached.cachedTours;\n        console.log(`[ClickPath] Using ${this.tours.length} cached tours`);\n      }\n      if (cached.cachedColors) {\n        this.applyTheme(cached.cachedColors);\n      }\n      if (cached.cachedConfig) {\n        this.config = { ...this.config, ...cached.cachedConfig };\n      }\n    }\n  }\n\n  /**\n   * Apply cached theme colors immediately on load\n   */\n  private async applyCachedTheme(): Promise<void> {\n    try {\n      const cached = await chrome.storage.local.get('cachedColors');\n      if (cached.cachedColors) {\n        this.applyTheme(cached.cachedColors);\n      }\n    } catch {\n      // Ignore errors\n    }\n  }\n\n  /**\n   * Apply theme colors as CSS variables\n   */\n  private applyTheme(colors: Partial<ThemeColors>): void {\n    const root = document.documentElement;\n\n    if (colors.primary) root.style.setProperty('--clickpath-primary', colors.primary);\n    if (colors.primaryDark) root.style.setProperty('--clickpath-primary-dark', colors.primaryDark);\n    if (colors.primaryLight) root.style.setProperty('--clickpath-primary-light', colors.primaryLight);\n    if (colors.background) root.style.setProperty('--clickpath-background', colors.background);\n    if (colors.text) root.style.setProperty('--clickpath-text', colors.text);\n    if (colors.textMuted) root.style.setProperty('--clickpath-text-muted', colors.textMuted);\n    if (colors.success) root.style.setProperty('--clickpath-success', colors.success);\n    if (colors.warning) root.style.setProperty('--clickpath-warning', colors.warning);\n\n    console.log('[ClickPath] Applied theme colors:', colors);\n  }\n\n  /**\n   * Load bundled example tours as fallback\n   */\n  private async loadBundledTours(): Promise<void> {\n    try {\n      const response = await fetch(chrome.runtime.getURL('tours/example-tour.json'));\n      if (response.ok) {\n        const tour = await response.json();\n        this.tours = [tour];\n        console.log('[ClickPath] Loaded bundled example tour');\n      }\n    } catch (error) {\n      console.error('[ClickPath] Failed to load bundled tours:', error);\n    }\n  }\n\n  private handleMessage(\n    message: MessageType,\n    _sender: chrome.runtime.MessageSender,\n    sendResponse: (response: MessageResponse) => void\n  ): boolean {\n    switch (message.type) {\n      case 'PING':\n        sendResponse({ success: true, data: { installed: true } });\n        break;\n\n      case 'START_TOUR':\n        this.startTour(message.tourId);\n        sendResponse({ success: true });\n        break;\n\n      case 'STOP_TOUR':\n        this.stopTour();\n        sendResponse({ success: true });\n        break;\n\n      case 'GET_TOURS':\n        sendResponse({\n          success: true,\n          data: this.tours.map(t => ({ id: t.id, name: t.name, description: t.description }))\n        });\n        break;\n\n      case 'GET_STATE':\n        sendResponse({\n          success: true,\n          data: this.tourEngine?.getState() ?? null\n        });\n        break;\n\n      case 'FETCH_TOURS_FROM_CORPORATER':\n        this.loadFromCorporater().then(() => {\n          sendResponse({ success: true, data: this.tours });\n        });\n        return true; // Keep channel open for async\n\n      default:\n        sendResponse({ success: false, error: 'Unknown message type' });\n    }\n\n    return true;\n  }\n\n  private checkAutoStart(): void {\n    const currentUrl = window.location.href;\n\n    for (const tour of this.tours) {\n      if (tour.trigger.mode !== 'auto') continue;\n\n      // Find matching page\n      const matchingPage = tour.pages.find(page => this.matchUrl(currentUrl, page));\n      if (!matchingPage) continue;\n\n      // Check auto conditions\n      if (tour.trigger.autoConditions?.firstVisit) {\n        const completedKey = `tour_completed_${tour.id}`;\n        chrome.storage.local.get(completedKey, (result) => {\n          if (!result[completedKey]) {\n            console.log(`[ClickPath] Auto-starting tour: ${tour.name}`);\n            setTimeout(() => this.startTour(tour.id), 1000);\n          }\n        });\n      }\n    }\n  }\n\n  private matchUrl(url: string, page: { urlPattern: string; urlMatchMode: string }): boolean {\n    switch (page.urlMatchMode) {\n      case 'exact':\n        return url === page.urlPattern;\n      case 'contains':\n        return url.includes(page.urlPattern);\n      case 'regex':\n        return new RegExp(page.urlPattern).test(url);\n      case 'glob':\n        const pattern = page.urlPattern\n          .replace(/\\*/g, '.*')\n          .replace(/\\?/g, '.');\n        return new RegExp(`^${pattern}$`).test(url);\n      default:\n        return url.includes(page.urlPattern);\n    }\n  }\n\n  private startTour(tourId: string): void {\n    const tour = tourId\n      ? this.tours.find(t => t.id === tourId)\n      : this.tours.find(t => t.pages.some(p => this.matchUrl(window.location.href, p)));\n\n    if (!tour) {\n      console.error(`[ClickPath] Tour not found: ${tourId || 'for current page'}`);\n      return;\n    }\n\n    const currentUrl = window.location.href;\n    const pageIndex = tour.pages.findIndex(page => this.matchUrl(currentUrl, page));\n\n    if (pageIndex === -1) {\n      console.warn(`[ClickPath] No matching page for current URL in tour: ${tour.id}`);\n      return;\n    }\n\n    this.stopTour();\n    this.tourEngine = new TourEngine(tour, pageIndex);\n    this.tourEngine.start();\n  }\n\n  private stopTour(): void {\n    if (this.tourEngine) {\n      this.tourEngine.stop();\n      this.tourEngine = null;\n    }\n  }\n\n  private injectHelpButton(): void {\n    const currentUrl = window.location.href;\n    const hasTours = this.tours.some(tour =>\n      tour.pages.some(page => this.matchUrl(currentUrl, page))\n    );\n\n    if (!hasTours && this.tours.length === 0) {\n      // Always show button if we have any tours (might match later)\n      // Or show if we couldn't load tours yet\n    }\n\n    // Remove existing button if any\n    document.querySelector('.clickpath-help-button')?.remove();\n\n    const button = document.createElement('button');\n    button.className = 'clickpath-help-button';\n    button.innerHTML = '?';\n    button.title = 'Start guided tour (Ctrl+Shift+T)';\n    button.addEventListener('click', () => {\n      const tour = this.tours.find(t =>\n        t.pages.some(page => this.matchUrl(currentUrl, page))\n      );\n      if (tour) {\n        this.startTour(tour.id);\n      } else if (this.tours.length > 0) {\n        // Start first available tour\n        this.startTour(this.tours[0].id);\n      }\n    });\n\n    document.body.appendChild(button);\n  }\n}\n\n// Initialize content script\nnew ClickPathContent();\n"],"names":["TourEngine","constructor","tour","startPageIndex","currentStepIndex","overlay","this","currentPageIndex","state","tourId","id","startedAt","Date","now","lastActivityAt","start","console","log","name","createOverlay","showStep","stop","removeOverlay","getState","currentPage","pages","currentStep","steps","totalSteps","length","document","createElement","className","innerHTML","querySelector","addEventListener","skip","prevStep","nextStep","body","appendChild","remove","step","highlight","tooltip","condition","elementExists","targetElement","element","elementFallback","fallback","rect","getBoundingClientRect","padding","settings","spotlightPadding","style","display","top","window","scrollY","left","scrollX","width","height","scrollBehavior","scrollIntoView","behavior","block","interaction","clickThrough","pointerEvents","titleEl","contentEl","indicatorEl","textContent","title","content","positionTooltip","position","backBtn","nextBtn","skipBtn","allowSkip","target","preferredPosition","tooltipRect","viewportWidth","innerWidth","viewportHeight","innerHeight","margin","targetRect","spaceAbove","spaceBelow","bottom","spaceLeft","spaceRight","right","Math","max","min","complete","saveProgress","status","key","chrome","storage","local","set","completedAt","version","tourEngine","tours","config","enableAutoStart","enableHelpButton","init","location","href","applyCachedTheme","loadFromCorporater","loadBundledTours","runtime","onMessage","addListener","handleMessage","bind","checkAutoStart","injectHelpButton","endpoint","response","fetch","method","credentials","headers","ok","warn","data","json","success","record","user","toursArray","JSON","parse","filter","t","cachedTours","e","colors","primary","primaryDark","primaryLight","background","text","textMuted","successColor","warning","applyTheme","cachedColors","cachedConfig","error","cached","get","root","documentElement","setProperty","getURL","message","_sender","sendResponse","type","installed","startTour","stopTour","map","description","then","currentUrl","trigger","mode","find","page","matchUrl","autoConditions","firstVisit","completedKey","result","setTimeout","url","urlMatchMode","urlPattern","includes","RegExp","test","pattern","replace","some","p","pageIndex","findIndex","button"],"ignoreList":[],"sourceRoot":""}